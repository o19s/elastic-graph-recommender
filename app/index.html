<!doctype html>
<html ng-app='recsApp'>
<head>
  <!-- <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css" ></link> -->
  <!-- <link rel="stylesheet" href="bower_components/angular-bootstrap/ui-bootstrap-csp.css"></link> -->
  <link rel="stylesheet" href="styles/app.css"></link>
  <script src="bower_components/jquery/dist/jquery.js"></script>
  <!-- <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script> -->
  <script src="bower_components/angular/angular.js"></script>
  <script src="bower_components/elasticsearch/elasticsearch.angular.js"></script>
  <!-- <script src="bower_components/angular-bootstrap/ui-bootstrap.js"></script> -->
  <!-- <script src="bower_components/angular-bootstrap/ui-bootstrap-tpls.js"></script> -->
  <script src="scripts/app.js"></script>
  <script src="scripts/graphUtilsSvc.js"></script>
  <script src="scripts/recsSvc.js"></script>
  <script src="scripts/appModeCtrl.js"></script>
  <script src="scripts/customRecsCtrl.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,900" rel="stylesheet">
</head>
<body ng-controller="CustomRecsCtrl as customRecs">
  <header>
    <h1>Elastic Graph Recommender Sandbox</h1>
    <p>Lightweight recommendations with Elasticsearch</p>
    <br>
  </header>

  <ul class="tabs">
    <!--<li role="presentation" ng-class="customRecs.mode == 'profile' ? 'active' : ''"><a ng-click="customRecs.mode='profile'" href="#">User Profiles</a></li>-->
    <li role="presentation" ng-class="customRecs.mode == 'define' ? 'active' : ''"><a href="#" ng-click="customRecs.recs.setMode('define')">Your Favorite Movies</a></li>
    <li role="presentation" ng-class="customRecs.mode == 'simple' ? 'active' : ''"><a href="#" ng-click="customRecs.recs.setMode('simple')">Searching for Similar Users</a></li>
    <li role="presentation" ng-class="customRecs.mode == 'relevance' ? 'active' : ''"><a href="#" ng-click="customRecs.recs.setMode('relevance')">Tuning Relevance</a></li>
    <li role="presentation" ng-class="customRecs.mode == 'graph' ? 'active' : ''"><a href="#" ng-click="customRecs.recs.setMode('graph')">Graph Operations</a></li>
    <li role="presentation" ng-class="customRecs.mode == 'what-else' ? 'active' : ''"><a href="#" ng-click="customRecs.recs.setMode('what-else')">What else?</a></li>
  </ul>

  <div>
    
    <div ng-show="customRecs.mode == 'define'">
      <div class="intro">
          <p>Welcome! In this demo, we're demonstrating the power of Elasticsearch's Graph plugin to build and tune recommendor systems.</p>
      </div>
        <h2>Start by adding a few movies that you like below:</h2>

      <div class="flex-grid">
        <div ng-repeat="movie in customRecs.recs.likes" class="col">
          <img src="{{movie.poster_path}}" title={{movie.title}}></img>
          <span class="remove-movie" ng-click="customRecs.removeMovie(movie)">x</span>
        </div>
      </div>

       
          <div class="input-group">
          <input type="text" class="form-control" ng-change="customRecs.search.run()" ng-model="customRecs.search.searchString" placeholder="movie title">
            <button class="btn" type="button">Search</button>
        </div>
        <div class="flex-grid">
          <div ng-repeat="movie in customRecs.search.hits" class="col">
            <img ng-click="customRecs.addMovie(movie);" src="{{movie.poster_path}}" title={{movie.title}}></img>
          </div>
        </div>

      </div>
    </div>


    <div ng-show="customRecs.mode == 'simple'">

      <div class="intro">
        <p>Elastic Graph uses search to find users <em>most similar to you</em>, finding movies you've missed but folks just like you consider significant.</p>
        

        <p>Play with user matchmaking settings, and see what you think of the results</p>
        <ul>
          <li><label>How many similar users should be examined?
             <input type="number" name="sample-size" ng-model="customRecs.recs.config.numSimilarUsers" min="0" max="1000" ng-change="customRecs.recs.run()"></input>
           </label></li>

          <li><label>What percentage of movies should overlap?
            <input type="number" name="sample-size" ng-model="customRecs.recs.config.minMovies" min="1" max="200" ng-change="customRecs.recs.run()"></input><span>%</span>
           </label></li>


        </ul>
        
        <p>Here, we find like users JUST using explicitly liked movies, below are what folks just like you also like.</p>
      </div>


      <div class="flex-grid">
        <div class="col" ng-repeat="movie in customRecs.recs.relatedMovies" style="display: inline-block">
          <img src="{{movie.poster_path}}" title={{movie.title}}></img>
        </div>
      </div>

    </div>

  </div>

  <div ng-show="customRecs.mode == 'relevance'">
    <div class="intro">
      
      <p>Quite a lot of <a href="http://manning.com/books/relevant-search">Relevance Work</a> can be brought to bear to improve Elastic Graph's ability to find similar users. Below, you can match directly to specific attributes of preferred movies:</p>
      

      <form>
        <h3>Use preferred movie's:</h3>
        <label>Release Date
          <input type="checkbox" name="date" ng-model="customRecs.recs.config.useDate" ng-change="customRecs.recs.run()"></input>
        </label>
        &nbsp;

        <label>Genre
          <input type="checkbox" name="genre" ng-model="customRecs.recs.config.useGenre" ng-change="customRecs.recs.run()"></input>
        </label>
        &nbsp;
        
        <label>Description Text
          <input type="checkbox" name="genre" ng-model="customRecs.recs.config.useOverviews" ng-change="customRecs.recs.run()"></input>
        </label>
      </form>
      
      <p>What do you think of the results? What other data about you/users could improve how easily we find users similar to you?</p>


    </div>

    <div class="flex-grid" ng-if="customRecs.recs.relatedMovies">
      <div class="col" ng-repeat="movie in customRecs.recs.relatedMovies" style="display: inline-block">
        <img src="{{movie.poster_path}}" title={{movie.title}}></img>
      </div>
    </div>

  </div>
    <div ng-show="customRecs.mode == 'graph'">

      <div class="intro">
        <p>We can do so much more with Elastic Graph. Let's reach beyond direct recommendations to see how your recommendations are linked to others. We can guide globally, or scope our graph-based guidance to users similar to you.</p>


        <form name="graph-mode">
          <label>Show what everyone likes
          <input type="radio" ng-model="customRecs.recs.config.globalGuidance" ng-change="customRecs.recs.run()" ng-value="true">
          </label>
          <label>Show just movies I probably like
          <input type="radio" ng-model="customRecs.recs.config.globalGuidance" ng-change="customRecs.recs.run()" ng-value="false">
          </label>
        </form>

        <div class="graph-list">
          <h3 style="display: inline">Considering?</h3>
          <h3 style="display: inline; margin-left: 5em;">You might also like:</h3>
        <ul>
            <li ng-repeat="movie in customRecs.recs.relatedMovies|limitTo:3">
              <div class="seed-movie">
                <img src="{{movie.poster_path}}" title={{movie.title}}></img>
              </div>
              <div ng-repeat="subMovie in movie.related|limitTo:3" style="display: inline-block">
                <img src="{{subMovie.poster_path}}" title={{subMovie.title}}></img>
              </div>
            </li>

        </ul>
        </div>

    </div>
  

  </div>


</body>
</html>
